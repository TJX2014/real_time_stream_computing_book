# 开源分布式流计算框架

在前面的章节中，我们实现了自己的流计算框架。在实现过程中，我们关注了就计算几个最核心的要素：

1. 流的本质：事件异步处理，并形成流水线；
2. 流的描述：DAG拓扑结构；
3. 流量控制：反向压力；
4. 流的状态：流数据状态和流信息状态。

我们用这个框架实现了风控场景下特征提取的服务，并将其扩展为特征提取服务集群。
在这个场景下，我们开发的这个流计算框架已经完全够用了。
但是，如果是以一个成熟通用的流计算平台标准来看，我们开发的这个流计算框架却还有很长的路要走。
这是因为，这个框架存在以下问题：
1. 它不是一个平台，只是一个编程框架。虽然可以部署为集群，但对于通常平台所要求的作业调度、资源管理等功能统统都没有。
2. 流的描述不够抽象。这包含两层意思。一是只使用了比较底层的异步编程API，
没提供更加上层的流计算编程API，比如map、filter、reduce等等。
二是DAG的执行是在单一节点上完成，不像很多流计算平台DAG的节点可以分配到不同计算节点上执行。
3. 作为流计算框架，只支持来一个事件就处理一个事件，不支持事件顺序校正，也不支持事件流按批次（各种窗口）处理。
4. 消息传达保证。比如至多一次(at most once)、至少一次(at least once)以及恰好一次(exactly once)等消息传达的保证。
5. 错误处理。当消息处理失败时的处理策略。
6. 其它可能的问题......

或许我们可以逐步地在现有框架上实现这些功能，但是这将是一个非常漫长并具有很多不确定性的过程。
因此，我们还是需要研究已有的流计算解决方案。如无特别必要，而又能满足产品需求，还是尽量选择已有成熟流计算方案。

当然，这并不是说我们开发的流计算框架一无是处，不能够真刀真枪上战场。
事实上，笔者就用自己开发的流计算框架，实现了一个特征计算平台，并用于生产环境。
而且在实际生产中发现，在明确了使用场景的边界后，我们的特征计算平台在自己擅长的领域里，
比各种开源框架开发和使用起来都更加灵活方便，资源使用效率更高，运维工作也更加简单轻松。
这也是"重复造轮子"的意义所在之一。

在本章中，我们将分析几种开源流计算框架，毕竟知己知彼方能百战不殆。
通过对这些开源流计算框架的学习，我们能够更加全面理解流计算系统，把握流计算的发展前沿和前进方向。

我们会从如下几个方面来考察流计算平台。
1. 系统架构。理解一个流计算平台的设计架构，是使用这个流计算平台的基础。
2. 流的描述。包括DAG表述和API接口。
3. 流的处理。流的处理过程，是否支持反向压力等等。
4. 流的状态。包括流数据状态和流信息状态。
5. 消息处理可靠性。对消息传达的保证如何。
当然，除了这几个方面外，还有些系统设计和实现中比较通用的问题，比如分布式节点在故障退出后如何恢复的问题。
由于这些问题并非"流"这个领域核心的问题，故在本章中将不做详细讨论。